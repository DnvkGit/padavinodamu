<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>పద వినోదము - Telugu Wordle</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Telugu:wght@400;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: hsl(258 96% 6%);
            color: hsl(210 40% 98%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        
        .container {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 0.5rem;
        }
        
        .header-title {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .font-telugu {
            font-family: 'Noto Sans Telugu', serif;
        }
        
        .input-section {
            margin-bottom: 1rem;
            background: hsl(258 96% 8%);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid hsl(258 40% 12%);
        }
        
        .input-label {
            font-size: 0.875rem;
            color: hsl(199 89% 72%);
            margin-bottom: 0.75rem;
            font-weight: 500;
        }
        
        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .input-field {
            background: hsl(258 96% 6%);
            border: 1px solid hsl(258 40% 12%);
            border-radius: 8px;
            padding: 0.75rem;
            color: hsl(210 40% 98%);
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s;
        }
        
        .input-field:focus {
            border-color: hsl(258 90% 65%);
        }
        
        .preview-area {
            background: hsl(258 96% 6%);
            border: 1px solid hsl(258 40% 12%);
            border-radius: 8px;
            padding: 0.75rem;
            min-height: 50px;
            display: flex;
            align-items: center;
            font-size: 1.125rem;
        }
        
        .btn {
            background: hsl(258 90% 65%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            width: 100%;
        }
        
        .btn:hover:not(:disabled) {
            background: hsl(258 90% 70%);
        }
        
        .btn:disabled {
            background: hsl(258 40% 25%);
            cursor: not-allowed;
        }
        
        .game-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.375rem;
            margin-bottom: 1rem;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .game-tile {
            aspect-ratio: 1;
            border: 1px solid hsl(258 40% 12%);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.2s;
            height: 50px;
            max-height: 50px;
        }
        
        .tile-correct {
            background: hsl(142 76% 36%);
            border-color: hsl(142 76% 36%);
            color: white;
        }
        
        .tile-wrong-syllable {
            background: hsl(48 96% 53%);
            border-color: hsl(48 96% 53%);
            color: black;
        }
        
        .tile-wrong-pos-gunintam {
            background: hsl(327 73% 73%);
            border-color: hsl(327 73% 73%);
            color: black;
        }
        
        .tile-wrong-pos-samyuk {
            background: hsl(271 91% 65%);
            border-color: hsl(271 91% 65%);
            color: white;
        }
        
        .tile-wrong-pos-samyuk-cons {
            background: rgb(150, 70, 0);
            border-color: rgb(170, 90, 20);
            color: white;
        }
        
        .tile-wrong-gunintam {
            background: hsl(199 89% 72%);
            border-color: hsl(199 89% 72%);
            color: black;
        }
        
        .tile-wrong-samyuk {
            background: rgb(150, 70, 0);
            border-color: rgb(170, 90, 20);
            color: white;
        }
        
        .tile-absent {
            background: hsl(215 13% 37%);
            border-color: hsl(215 13% 37%);
            color: white;
        }
        
        .game-status {
            text-align: center;
            margin-top: 2rem;
        }
        
        .status-won {
            color: hsl(142 76% 50%);
            font-size: 1.25rem;
            font-weight: 600;
            background: hsl(142 76% 15%);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid hsl(142 76% 30%);
            text-align: center;
        }
        
        .status-lost {
            color: hsl(0 84% 60%);
            font-size: 1.25rem;
            font-weight: 600;
            background: hsl(0 84% 15%);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid hsl(0 84% 30%);
            text-align: center;
        }
        
        .hint-display {
            position: fixed;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            background: hsl(48 96% 15%);
            border: 1px solid hsl(48 96% 30%);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            color: hsl(48 96% 70%);
            z-index: 1000;
            max-width: 90%;
            animation: fadeInOut 4s ease-in-out forwards;
        }
        
        .congratulation-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: hsl(142 76% 15%);
            border: 2px solid hsl(142 76% 30%);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            z-index: 1000;
            color: hsl(142 76% 70%);
            font-size: 1.25rem;
            font-weight: 600;
            animation: sparkleAndFade 5s ease-in-out forwards;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(10px); }
            15% { opacity: 1; transform: translateY(0); }
            85% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-10px); }
        }
        
        @keyframes sparkleAndFade {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            15% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            20% { transform: translate(-50%, -50%) scale(1.05); }
            25% { transform: translate(-50%, -50%) scale(1); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
        }
        
        .history-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        
        .history-content {
            background: hsl(258 96% 8%);
            border: 1px solid hsl(258 40% 25%);
            border-radius: 12px;
            padding: 2rem;
            max-width: 400px;
            width: 100%;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .history-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: hsl(199 89% 72%);
        }
        
        .close-btn {
            background: none;
            border: none;
            color: hsl(210 40% 80%);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .close-btn:hover {
            background: hsl(258 40% 15%);
        }
        
        .date-list {
            list-style: none;
        }
        
        .date-item {
            background: hsl(258 96% 6%);
            border: 1px solid hsl(258 40% 15%);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-weight: 500;
            color: hsl(210 40% 90%);
        }
        
        .date-item:hover {
            border-color: hsl(258 40% 25%);
            background: hsl(258 96% 7%);
            color: hsl(210 40% 100%);
        }
        
        .date-item.today {
            border-color: hsl(258 90% 65%);
            background: hsl(258 90% 15%);
            color: hsl(258 90% 85%);
        }
        
        .current-date-display {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: hsl(258 96% 8%);
            border: 1px solid hsl(258 40% 25%);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            color: hsl(199 89% 72%);
            font-weight: 500;
        }
        
        @media (max-width: 640px) {
            .container {
                padding: 0.5rem;
            }
            
            .header-title {
                font-size: 1.75rem;
            }
            
            .game-tile {
                font-size: 0.875rem;
                height: 45px;
                max-height: 45px;
            }
            
            .game-grid {
                max-width: 250px;
                gap: 0.25rem;
            }
            
            .input-row {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
        }
    </style>
</head>
    
<body>
    <div class="container">
        <div class="header" style="position: relative;">
            <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 0.5rem; position: relative;">
                <h1 class="header-title font-telugu" style="color: hsl(258 90% 65%); margin: 0;">పద వినోదము</h1>
                <div id="currentDateDisplay" style="position: absolute; top: 0; right: 0; font-size: 0.875rem; color: hsl(199 89% 72%); display: none;">
                    Today
                </div>
            </div>
            <div style="display: flex; justify-content: center; align-items: center; gap: 0.5rem;">
                <button id="helpBtn" class="btn" style="padding: 0.5rem; width: auto; background: hsl(258 40% 25%);" title="Help">?</button>
                <button id="historyBtn" class="btn" style="padding: 0.5rem; width: auto; background: hsl(258 40% 25%);" title="History">📅</button>
                <button id="hintBtn" class="btn" style="padding: 0.5rem; width: auto; background: hsl(258 40% 25%);" title="Hint">💡</button>
                <button id="newGameBtn" class="btn" style="padding: 0.5rem; width: auto; background: hsl(258 40% 25%);" title="New Game">🔄</button>
            </div>
        </div>
        
        <div class="input-section">
            <div class="input-label">Type in English</div>
            <div class="input-row">
                <input 
                    type="text" 
                    id="englishInput"
                    class="input-field"
                    placeholder="e.g., sarigama"
                    autocapitalize="off"
                    autocomplete="off"
                    spellcheck="false"
                    inputmode="text"
                    
                    
                />
                <div id="teluguPreview" class="preview-area font-telugu">
                    <span style="color: hsl(215 13% 44%);">Telugu preview...</span>
                </div>
            </div>
            <button id="submitBtn" class="btn" disabled>Submit Guess</button>
        </div>
        
        <div id="gameGrid" class="game-grid">
            <!-- 40 tiles for 10 rows × 4 columns -->
        </div>
        
        <div id="gameStatus" class="game-status"></div>
        
        <!-- Easter Egg Display -->
        <div id="easterEgg" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: hsl(258 96% 8%); border: 2px solid hsl(258 90% 65%); border-radius: 12px; padding: 2rem; text-align: center; z-index: 1000;">
            <p style="margin-bottom: 1rem;">First syllable hint:</p>
            <div class="font-telugu" style="font-size: 2rem; color: hsl(258 90% 65%);"></div>
        </div>
        


        <!-- History Modal -->
        <div id="historyModal" class="history-modal">
            <div class="history-content">
                <div class="history-header">
                    <h2 class="history-title">Select Date</h2>
                    <button class="close-btn" onclick="toggleHistory()">&times;</button>
                </div>
                <ul id="dateList" class="date-list">
                    <!-- Date items will be populated here -->
                </ul>
            </div>
        </div>

        <!-- Help Modal -->
        <div id="helpModal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; overflow-y: auto;">
            <div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 1rem;">
                <div style="background: hsl(258 96% 8%); border-radius: 12px; padding: 2rem; max-width: 500px; width: 100%;">
                    <h2 style="text-align: center; margin-bottom: 1.5rem; color: hsl(258 90% 65%);">How to Play</h2>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="color: hsl(199 89% 72%); margin-bottom: 0.5rem;">Color Guide:</h3>
                        <div style="display: grid; gap: 0.5rem; font-size: 0.875rem;">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div style="width: 20px; height: 20px; background: hsl(142 76% 36%); border-radius: 4px;"></div>
                                <span><strong style="color: hsl(142 76% 50%);">GREEN:</strong> Correct syllable in correct position</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div style="width: 20px; height: 20px; background: hsl(48 96% 53%); border-radius: 4px;"></div>
                                <span><strong style="color: hsl(48 96% 60%);">YELLOW:</strong> Correct syllable, wrong position</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div style="width: 20px; height: 20px; background: hsl(327 73% 73%); border-radius: 4px;"></div>
                                <span><strong style="color: hsl(327 73% 80%);">PINK:</strong> Same consonant, wrong gunintam</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div style="width: 20px; height: 20px; background: hsl(271 91% 65%); border-radius: 4px;"></div>
                                <span><strong style="color: hsl(271 91% 75%);">PURPLE:</strong> Same consonant, wrong samyuktakshara</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div style="width: 20px; height: 20px; background: hsl(199 89% 72%); border-radius: 4px;"></div>
                                <span><strong style="color: hsl(199 89% 80%);">LIGHT BLUE:</strong> Basic consonant match, gunintam wrong</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div style="width: 20px; height: 20px; background: hsl(25 95% 53%); border-radius: 4px;"></div>
                                <span><strong style="color: hsl(25 95% 65%);">BROWN:</strong> Basic consonant match, samyuktakshara wrong</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div style="width: 20px; height: 20px; background: hsl(215 13% 37%); border-radius: 4px;"></div>
                                <span><strong style="color: hsl(215 13% 44%);">GRAY:</strong> Not in word</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: hsl(258 90% 20%); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                        <p style="text-align: center; font-size: 0.875rem;">
                            <strong>Example:</strong> Type "sarigama" → gets "సరిగమ"
                        </p>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="color: hsl(199 89% 72%); margin-bottom: 0.5rem;">Tips:</h3>
                        <ul style="font-size: 0.875rem; padding-left: 1rem;">
                            <li>Type English letters to get Telugu syllables</li>
                            <li>Use the 💡 hint button (shows word meaning after solving at least one syllable)</li>
                            <li>Hold Ctrl+Shift for 3 seconds after 5 attempts for easter egg</li>
                            <li>Each guess must be exactly 4 syllables</li>
                        </ul>
                    </div>
                    
                    <button onclick="toggleHelp()" class="btn">Got it!</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // EXACT transliterator logic
        class Transliterator {
            constructor() {
                this.vowels = {
                    'a': 'అ', 'aa': 'ఆ', 'A': 'ఆ', 'i': 'ఇ', 'ee': 'ఈ', 'I': 'ఈ',
                    'u': 'ఉ', 'U': 'ఊ', 'Ri': 'ఋ', 'RI': 'ౠ', 'e': 'ఎ', 'E': 'ఏ',
                    'ai': 'ఐ', 'o': 'ఒ', 'O': 'ఓ', 'au': 'ఔ', 'M': 'ం', 'aM': 'అం', ':': 'ః'
                };

                this.vowelSigns = {
                    'a': '', 'aa': 'ా', 'A': 'ా', 'i': 'ి', 'ee': 'ీ', 'I': 'ీ',
                    'u': 'ు', 'oo': 'ూ', 'U': 'ూ', 'e': 'ె', 'E': 'ే', 'ai': 'ై',
                    'o': 'ొ', 'O': 'ో', 'au': 'ౌ', 'ou': 'ౌ', 'M': 'ం', '-': '్', 'M-': 'ఁ',
                    'Ri': 'ృ', 'RI': 'ౄ', ':': 'ః'
                };

                this.consonants = {
                    'k': 'క', 'kh': 'ఖ', 'K': 'ఖ', 'g': 'గ', 'gh': 'ఘ', 'G': 'ఘ', 'NG': 'ఙ',
                    'c': 'చ', 'ch': 'చ', 'chh': 'ఛ', 'C': 'ఛ', 'j': 'జ', 'jh': 'ఝ', 'J': 'ఝ', 'NY': 'ఞ',
                    'T': 'ట', 'Th': 'ఠ', 'D': 'డ', 'Dh': 'ఢ', 'N': 'ణ',
                    't': 'త', 'th': 'థ', 'd': 'ద', 'dh': 'ధ', 'n': 'న',
                    'p': 'ప', 'ph': 'ఫ', 'f': 'ఫ', 'b': 'బ', 'bh': 'భ', 'B': 'భ', 'm': 'మ',
                    'y': 'య', 'r': 'ర', 'l': 'ల', 'L': 'ళ', 'v': 'వ', 'w': 'వ', 'S': 'శ', 's': 'స',
                    'sh': 'ష', 'Sh': 'ష', 'h': 'హ', 'kSh': 'క్ష', 'x': 'క్ష'
                };

                this.nconjoins = {
                    'nk': 'ం', 'nkh': 'ం', 'ng': 'ం', 'ngh': 'ం', 'nc': 'ం', 'nch': 'ం',
                    'nj': 'ం', 'njh': 'ం', 'nT': 'ం', 'nTh': 'ం', 'nD': 'ం', 'nDh': 'ం',
                    'nt': 'ం', 'nth': 'ం', 'nd': 'ం', 'ndh': 'ం', 'nl': 'ం', 'ns': 'ం',
                    'nS': 'ం', 'nSh': 'ం'
                };

                this.virama = '్';
                this.anusvar = 'ం';
            }

            transliterate(inputText) {
                if (!inputText || typeof inputText !== 'string') {
                    return '';
                }

                let output = '';
                let i = 0;
                const n = inputText.length;

                while (i < n) {
                    let found = false;
                    
                    // Check for vowels first
                    for (const vLen of [2, 1]) {
                        const vowelStr = inputText.substring(i, i + vLen);
                        if (i + vLen <= n && vowelStr in this.vowels) {
                            output += this.vowels[vowelStr];
                            i += vLen;
                            found = true;
                            break;
                        }
                    }
                    
                    if (!found) {
                        // Check for consonants
                        for (const cLen of [3, 2, 1]) {
                            const consStr = inputText.substring(i, i + cLen);
                            if (i + cLen <= n && consStr in this.consonants) {
                                const cons = consStr;
                                i += cLen;
                                let vowel = '';
                                
                                // Look ahead for vowel
                                for (const vLen of [2, 1]) {
                                    const vowelStr = inputText.substring(i, i + vLen);
                                    if (i + vLen <= n && vowelStr in this.vowelSigns) {
                                        vowel = vowelStr;
                                        i += vLen;
                                        break;
                                    }
                                }
                                
                                // Handle n-joins as anusvara or virama
                                if (cons === 'n' && vowel === '') {
                                    const checkStr = inputText.substring(i - cLen, i + 1);
                                    if (checkStr in this.nconjoins) {
                                        output += this.anusvar;
                                    } else {
                                        output += this.consonants[cons] + this.virama;
                                    }
                                } else {
                                    output += this.consonants[cons];
                                    if (vowel in this.vowelSigns) {
                                        output += this.vowelSigns[vowel];
                                    } else if (vowel === '') {
                                        output += this.virama;
                                    }
                                }
                                
                                found = true;
                                break;
                            }
                        }
                        
                        if (!found) {
                            output += inputText[i];
                            i += 1;
                        }
                    }
                }

                return output;
            }

            splitIntoSyllables(tword) {
                if (!tword || typeof tword !== 'string') {
                    return ['', '', '', ''];
                }

                const arrU = Array.from(tword).map(ch => ch.charCodeAt(0));
                const arrE = [];
                let i = 0;
                const size1 = arrU.length;

                while (i < size1) {
                    const tc = arrU[i];
                    const nxtch = i + 1 < size1 ? arrU[i + 1] : null;
                    const nxtnxtch = i + 2 < size1 ? arrU[i + 2] : null;

                    arrE.push(String.fromCharCode(tc));

                    if (this.isAcchu(tc) && (nxtch === null || !this.isSpl(nxtch))) {
                        arrE.push(',');
                    } else if (this.isAcchu(tc) && this.isSpl(nxtch)) {
                        arrE.push(String.fromCharCode(nxtch));
                        arrE.push(',');
                        i += 1;
                    } else if (this.isHallu(tc) && (nxtch !== null && (this.isHallu(nxtch) || this.isAcchu(nxtch)))) {
                        arrE.push(',');
                    } else if (this.isHallu(tc) && (nxtch !== null && (this.isMatra(nxtch) || this.isSpl(nxtch)))) {
                        arrE.push(String.fromCharCode(nxtch));
                        if (nxtnxtch !== null && this.isSpl(nxtnxtch)) {
                            arrE.push(String.fromCharCode(nxtnxtch));
                            i += 1;
                        }
                        arrE.push(',');
                        i += 1;
                    } else if (this.isSpace(tc)) {
                        if (arrE.length >= 2 && arrE[arrE.length - 2] !== ',') {
                            arrE.push(',');
                        }
                        arrE.push('*');
                        arrE.push(',');
                    }

                    i += 1;
                }

                arrE.push(',');
                const syllables = arrE.join('').split(',');
                const filtered = syllables.map(syl => syl.trim()).filter(syl => syl !== '');
                
                // Ensure we have exactly 4 syllables
                while (filtered.length < 4) {
                    filtered.push('');
                }
                
                return filtered.slice(0, 4);
            }

            isAcchu(unic) {
                return (3077 <= unic && unic <= 3092) || (unic === 3168);
            }

            isHallu(unic) {
                return (3093 <= unic && unic <= 3129) || (3160 <= unic && unic <= 3161);
            }

            isSpl(unic) {
                return 3072 <= unic && unic <= 3076;
            }

            isMatra(unic) {
                return (3133 <= unic && unic <= 3148) || (unic === 3074);
            }

            isSpace(unic) {
                return unic === 32;
            }
        }

        // Game logic
        const transliterator = new Transliterator();
        
        // Complete word list from TWORDLE.py
        const gameWords = [
            'కృపాణము:కరవాలము', 'అనుమానం:సందేహం', 'మరాళము:హంస', 'అవధూత:సన్యాసి', 'ఎండతాకు:వడదెబ్బ',
            'తాళగింపు:తాళమువేయు', 'తిరకాసు:జటిలసమస్య', 'ఒరిపిడి:రాపిడి', 'కరటక:ఎండ్రకాయ', 'సరభస:కోపం కలవాడు',
            'ఆలాపన:రాగాలాపము', 'నిశాగణ:రాత్రి సమూహము', 'కొండకోతి:కొండముచ్చు', 'బద్ధముష్టి:పిసినిగొట్టు',
            'దృష్టితీరు:వైఖరి', 'రామాయణం:రాముని చరితం', 'డాబుసరి:దర్పము', 'కనుబొమ:భ్రుకుటి', 'సహకారం:సమిష్టి',
            'నడిరేయి:అర్ధరాత్రి', 'బంధువులు:చుట్టాలు', 'అక్కటిక:కనికరం', 'ఇందీవరం:నల్లగలువ', 'అడ్డకట్టు:నిరోధించు',
            'దివెగుడి:దీపపు గూడు', 'ఘృతశాక:నెయ్యితో కలిపిన కూర', 'కుశలత:నేర్పు', 'కవుగిలి:ఆలింగనము',
            'అభిశస్తి:అపవాదము', 'వర్ణనలు:వర్ణనలు', 'ప్రవర్తన:నడత', 'కల్మషాలు:చెడులు', 'మీనకేతు:మన్మథుఁడు', 'పొలిమేర:సరిహద్దు',
            'కడియాలు:కంకణములు', 'కబళము:ముద్ద', 'వడియాలు:వేయించిన తిను బండారం', 'నిషిద్దము:ప్రతిబంధము',
            'కుందనము:మేలిమి బంగారము', 'బ్రహ్మాండము:విశ్వము', 'మేలురాక:స్వాగతము', 'అనుక్షణం:ప్రతిక్షణము',
            'మరకత:పచ్చఱాయి', 'సౌరభము:పరిమళము', 'కరవాలం:కత్తి', 'సమావేశం:కూటమి', 'పతకము:నగ', 'కనుకట్టు:ఇంద్రజాలము',
            'వడుకము:వడియము', 'ఉత్సుకత:తహతహ', 'కళ్ళువిచ్చు:జ్ఞానోదయమగు', 'భూమార్గము:సొరంగము', 'సతమతం:ఆయాసము'
        ];
        
        const STRDT = 45794; // Start date reference from TWORDLE.py
        
        // Get word of the day based on date
        function getWordOfDay(date = new Date()) {
            const excelDate = Math.floor((date - new Date(1899, 11, 30)) / (1000 * 60 * 60 * 24));
            const elem = excelDate - STRDT;
            
            let wordMean;
            try {
                wordMean = gameWords[elem % gameWords.length];
            } catch {
                wordMean = gameWords[Math.floor(Math.random() * gameWords.length)];
            }
            
            const delimPos = wordMean.indexOf(':');
            const word = wordMean.substring(0, delimPos).trim().replace(/ /g, '');
            const meaning = wordMean.substring(delimPos + 1).trim();
            const syllables = transliterator.splitIntoSyllables(word);
            
            return { word, meaning, syllables };
        }
        
        let currentWord = getWordOfDay();
        let guesses = [];
        let gameStatus = 'playing';
        let easterEggTimer = null;
        
        // DOM elements
        const englishInput = document.getElementById('englishInput');
        const teluguPreview = document.getElementById('teluguPreview');
        const submitBtn = document.getElementById('submitBtn');
        const gameGrid = document.getElementById('gameGrid');
        const gameStatusDiv = document.getElementById('gameStatus');
        const helpBtn = document.getElementById('helpBtn');
        const historyBtn = document.getElementById('historyBtn');
        const hintBtn = document.getElementById('hintBtn');
        const newGameBtn = document.getElementById('newGameBtn');
        const helpModal = document.getElementById('helpModal');
        const easterEggDiv = document.getElementById('easterEgg');
        // targetMeaning removed to save space
        
        let hintsUsed = 0;
        
        // Initialize game grid
        function initializeGrid() {
            gameGrid.innerHTML = '';
            for (let i = 0; i < 40; i++) {
                const tile = document.createElement('div');
                tile.className = 'game-tile font-telugu';
                gameGrid.appendChild(tile);
            }
        }
        
        // Update preview
        function updatePreview() {
            const englishText = englishInput.value;
            const teluguText = transliterator.transliterate(englishText);
            
            if (teluguText) {
                teluguPreview.textContent = teluguText;
                submitBtn.disabled = false;
            } else {
                teluguPreview.innerHTML = '<span style="color: hsl(215 13% 44%);">Telugu preview...</span>';
                submitBtn.disabled = true;
            }
        }
        
        // Complete 6-color analysis from TWORDLE.py
        function analyzeGuess(guess, target, targetSyllables) {
            const guessSyllables = transliterator.splitIntoSyllables(guess);
            const colors = [];
            const targetFirstChars = targetSyllables.map(syl => syl ? syl.charCodeAt(0) : 0);
            
            for (let i = 0; i < 4; i++) {
                const guessSyll = guessSyllables[i] || '';
                const targetSyll = targetSyllables[i] || '';
                
                // 1. GREEN: Exact match
                if (guessSyll === targetSyll) {
                    colors.push('correct');
                    continue;
                }
                
                // 2. PINK/PURPLE/BROWN: Same position, same base consonant, different gunintam/samyuktakshara
                if (guessSyll && targetSyll && guessSyll.charCodeAt(0) === targetSyll.charCodeAt(0)) {
                    // Check if it's a samyuktakshara (consonant + consonant)
                    const hasConsonantJoin = (syllable) => {
                        if (syllable.length < 2) return false;
                        for (let i = 1; i < syllable.length; i++) {
                            const charCode = syllable.charCodeAt(i);
                            // Check if it's a consonant (hallu) including same consonant repetition
                            if ((3093 <= charCode && charCode <= 3129) || (3160 <= charCode && charCode <= 3161)) {
                                return true;
                            }
                        }
                        return false;
                    };
                    
                    const guessHasConsonant = hasConsonantJoin(guessSyll);
                    const targetHasConsonant = hasConsonantJoin(targetSyll);
                    
                    // If both have consonant joins or same consonant repetition -> BROWN (samyuktakshara)
                    if (guessHasConsonant || targetHasConsonant) {
                        colors.push('wrong-pos-samyuk-cons'); // BROWN
                    } else {
                        // Different gunintam (vowel signs only) -> PINK
                        colors.push('wrong-pos-gunintam'); // PINK
                    }
                    continue;
                }
                
                // 3. YELLOW: Wrong position but syllable exists
                if (guessSyll && targetSyllables.includes(guessSyll)) {
                    const targetCount = targetSyllables.filter(s => s === guessSyll).length;
                    const correctCount = guessSyllables.slice(0, 4).filter((s, idx) => 
                        s === targetSyllables[idx] && s === guessSyll).length;
                    const occurrenceCount = guessSyllables.slice(0, i + 1).filter(s => s === guessSyll).length;
                    
                    if (targetCount - correctCount - occurrenceCount + 1 >= 0) {
                        colors.push('wrong-syllable'); // YELLOW
                        continue;
                    }
                }
                
                // 4. LIGHT BLUE/BROWN: Wrong position, basic consonant match
                if (guessSyll && guessSyll.length > 0) {
                    const guessFirstChar = guessSyll.charCodeAt(0);
                    const targetCharCount = targetFirstChars.filter(c => c === guessFirstChar).length;
                    
                    if (targetCharCount > 0) {
                        const correctCharCount = guessSyllables.slice(0, 4).filter((s, idx) => 
                            s.length > 0 && s.charCodeAt(0) === targetFirstChars[idx] && 
                            s.charCodeAt(0) === guessFirstChar).length;
                        const charOccurrenceCount = guessSyllables.slice(0, i + 1).filter(s => 
                            s.length > 0 && s.charCodeAt(0) === guessFirstChar).length;
                        
                        if (targetCharCount - correctCharCount - charOccurrenceCount + 1 >= 0 && 
                            !targetSyllables.includes(guessSyll) && 
                            targetFirstChars.includes(guessFirstChar)) {
                            
                            const targetIndex = targetFirstChars.indexOf(guessFirstChar);
                            const targetMatch = targetSyllables[targetIndex];
                            
                            if (targetMatch && targetMatch.length - guessSyll.length > 1) {
                                colors.push('wrong-samyuk'); // BROWN
                            } else {
                                colors.push('wrong-gunintam'); // LIGHT BLUE
                            }
                            continue;
                        }
                    }
                }
                
                // 5. GRAY: Not found
                colors.push('absent');
            }
            
            return colors;
        }
        
        // Update game grid
        function updateGrid() {
            const tiles = gameGrid.children;
            
            for (let i = 0; i < 40; i++) {
                const rowIndex = Math.floor(i / 4);
                const colIndex = i % 4;
                const guess = guesses[rowIndex];
                
                if (guess) {
                    tiles[i].textContent = guess.syllables[colIndex] || '';
                    tiles[i].className = `game-tile font-telugu tile-${guess.colors[colIndex] || 'absent'}`;
                } else {
                    tiles[i].textContent = '';
                    tiles[i].className = 'game-tile font-telugu';
                }
            }
        }
        
        // Update game status
        function updateGameStatus() {
            if (gameStatus === 'won') {
                const attempts = guesses.length;
                const hintText = hintsUsed > 0 ? ' (with hint)' : '';
                const celebrations = ['🎉', '✨', '🌟', '🎊', '💫'];
                const randomCelebration = celebrations[Math.floor(Math.random() * celebrations.length)];
                
                // Show auto-dismissing congratulation message
                showCongratulationMessage(`${randomCelebration} Excellent! You solved it in ${attempts} attempt${attempts > 1 ? 's' : ''}${hintText}! ${randomCelebration}`);
                
                gameStatusDiv.innerHTML = `
                    <div class="status-won">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">${randomCelebration}</div>
                        <div><strong>Congratulations!</strong></div>
                        <div style="margin-top: 0.5rem;">You solved it in ${attempts} attempt${attempts > 1 ? 's' : ''}${hintText}!</div>
                        <div style="margin-top: 0.5rem; font-size: 1rem; color: hsl(142 76% 70%);">
                            Word: <span class="font-telugu">${currentWord.word}</span> (${currentWord.meaning})
                        </div>
                    </div>
                `;
            } else if (gameStatus === 'lost') {
                gameStatusDiv.innerHTML = `
                    <div class="status-lost">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">💔</div>
                        <div><strong>Game Over!</strong></div>
                        <div style="margin-top: 0.5rem;">The word was: <span class="font-telugu">${currentWord.word}</span></div>
                        <div style="margin-top: 0.5rem; font-size: 1rem; color: hsl(0 84% 70%);">
                            Meaning: ${currentWord.meaning}
                        </div>
                    </div>
                `;
            } else {
                gameStatusDiv.innerHTML = '';
            }
        }
        
        // Show auto-dismissing congratulation message
        function showCongratulationMessage(message) {
            const congratsDiv = document.createElement('div');
            congratsDiv.className = 'congratulation-message';
            congratsDiv.innerHTML = message;
            document.body.appendChild(congratsDiv);
            
            // Auto-remove after animation
            setTimeout(() => {
                if (congratsDiv.parentNode) {
                    congratsDiv.parentNode.removeChild(congratsDiv);
                }
            }, 5000);
        }
        
        // Submit guess
        function submitGuess() {
            if (gameStatus !== 'playing') return;
            
            const englishText = englishInput.value.trim();
            if (!englishText) return;
            
            const teluguText = transliterator.transliterate(englishText);
            const syllables = transliterator.splitIntoSyllables(teluguText);
            
            // Validate syllable count
            const validSyllables = syllables.filter(s => s.trim() !== '');
            if (validSyllables.length !== 4) {
                // Show validation message
                const existingValidation = document.querySelector('.validation-display');
                if (existingValidation) existingValidation.remove();
                
                const validationDiv = document.createElement('div');
                validationDiv.className = 'hint-display validation-display';
                validationDiv.innerHTML = `
                    <div><strong>Invalid Word Length</strong></div>
                    <div style="margin-top: 0.5rem;">Word should be exactly 4 syllables</div>
                    <div style="margin-top: 0.25rem; font-size: 0.875rem; opacity: 0.8;">Current: ${validSyllables.length} syllable${validSyllables.length !== 1 ? 's' : ''}</div>
                `;
                
                const inputSection = document.querySelector('.input-section');
                inputSection.parentNode.insertBefore(validationDiv, inputSection.nextSibling);
                
                return;
            }
            
            const colors = analyzeGuess(teluguText, currentWord.word, currentWord.syllables);
            
            guesses.push({
                guess: teluguText,
                syllables: syllables,
                colors: colors
            });
            
            // Check win/lose conditions
            if (teluguText === currentWord.word) {
                gameStatus = 'won';
            } else if (guesses.length >= 10) {
                gameStatus = 'lost';
            }
            
            // Clear input
            englishInput.value = '';
            updatePreview();
            updateGrid();
            updateGameStatus();
        }
        
        // Helper functions
        function toggleHelp() {
            helpModal.style.display = helpModal.style.display === 'none' ? 'flex' : 'none';
        }
        
        // History management functions
        let selectedDate = new Date();
        
        function toggleHistory() {
            const historyModal = document.getElementById('historyModal');
            const isVisible = historyModal.style.display === 'flex';
            
            if (!isVisible) {
                displayDateList();
                historyModal.style.display = 'flex';
            } else {
                historyModal.style.display = 'none';
            }
        }
        
        function displayDateList() {
            const dateList = document.getElementById('dateList');
            const today = new Date();
            const dateItems = [];
            
            // Generate past 7 days
            for (let i = 0; i < 7; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                
                const dateStr = date.toDateString();
                const isToday = i === 0;
                
                let displayText;
                if (isToday) {
                    displayText = 'Today';
                } else if (i === 1) {
                    displayText = 'Yesterday';
                } else {
                    displayText = date.toLocaleDateString('en-US', { 
                        weekday: 'long',
                        month: 'short', 
                        day: 'numeric' 
                    });
                }
                
                dateItems.push(`
                    <li class="date-item ${isToday ? 'today' : ''}" onclick="selectDate('${dateStr}')">
                        ${displayText}
                    </li>
                `);
            }
            
            dateList.innerHTML = dateItems.join('');
        }
        
        function selectDate(dateString) {
            selectedDate = new Date(dateString);
            
            // Update current date display
            const currentDateDisplay = document.getElementById('currentDateDisplay');
            const today = new Date();
            
            if (selectedDate.toDateString() === today.toDateString()) {
                // Hide date display for today
                currentDateDisplay.style.display = 'none';
            } else {
                // Show selected date in DD MMM YYYY format
                const displayText = selectedDate.toLocaleDateString('en-GB', { 
                    day: '2-digit',
                    month: 'short', 
                    year: 'numeric'
                }).replace(/,/g, '');
                currentDateDisplay.textContent = displayText;
                currentDateDisplay.style.display = 'block';
            }
            
            // Start new game with selected date
            startGameForDate(selectedDate);
            
            // Close history modal
            toggleHistory();
        }
        
        function startGameForDate(date) {
            // Reset game state
            guesses = [];
            gameStatus = 'playing';
            hintsUsed = 0;
            
            // Get word for the selected date
            currentWord = getWordOfDay(date);
            
            // Update UI
            englishInput.value = '';
            updatePreview();
            updateGrid();
            updateGameStatus();
            
            
            // Remove any existing displays
            const existingDisplays = document.querySelectorAll('.hint-display, .validation-display');
            existingDisplays.forEach(display => display.remove());
            
            // Reset hint button
            hintBtn.disabled = false;
            hintBtn.style.opacity = '1';
            hintBtn.title = 'Hint (requires at least one correct syllable)';
        }
        
        function newGame() {
            // Reset to today's date
            selectedDate = new Date();
            const currentDateDisplay = document.getElementById('currentDateDisplay');
            currentDateDisplay.style.display = 'none';
            
            guesses = [];
            gameStatus = 'playing';
            hintsUsed = 0;
            currentWord = getWordOfDay();
            englishInput.value = '';
            updatePreview();
            updateGrid();
            updateGameStatus();
            
            
            // Remove any existing hint or validation displays
            const existingDisplays = document.querySelectorAll('.hint-display, .validation-display');
            existingDisplays.forEach(display => display.remove());
            
            // Reset hint button
            hintBtn.disabled = false;
            hintBtn.style.opacity = '1';
            hintBtn.title = 'Hint (requires at least one correct syllable)';
        }
        
        function hasCorrectSyllable() {
            // Check if player has at least one Yellow or Green tile
            for (const guess of guesses) {
                for (const color of guess.colors) {
                    if (color === 'correct' || color === 'wrong-syllable') {
                        return true;
                    }
                }
            }
            return false;
        }
        
        function dismissHint() {
            const existingHint = document.querySelector('.hint-display');
            if (existingHint) {
                existingHint.remove();
            }
        }
        
        function showHint() {
            if (gameStatus !== 'playing' || hintsUsed >= 1) return;
            
            // Remove any existing hint
            dismissHint();
            
            // Check if player has solved at least one syllable
            if (!hasCorrectSyllable()) {
                // Show message that at least one syllable must be solved
                const hintDiv = document.createElement('div');
                hintDiv.className = 'hint-display';
                hintDiv.innerHTML = `
                    <div><strong>Hint Not Available</strong></div>
                    <div style="margin-top: 0.5rem;">At least one syllable to be solved for Hint</div>
                    <div style="margin-top: 0.25rem; font-size: 0.875rem; opacity: 0.8;">Get a Yellow or Green tile first!</div>
                `;
                
                // Add hint as fixed overlay to prevent layout displacement
                document.body.appendChild(hintDiv);
                
                // Auto-dismiss after 4 seconds
                setTimeout(() => {
                    if (hintDiv.parentNode) {
                        hintDiv.parentNode.removeChild(hintDiv);
                    }
                }, 4000);
                
                return;
            }
            
            hintsUsed++;
            
            // Show the word meaning as hint
            const hintDiv = document.createElement('div');
            hintDiv.className = 'hint-display';
            hintDiv.innerHTML = `
                <div><strong>Hint:</strong></div>
                <div style="margin-top: 0.5rem;">Word meaning: <strong>${currentWord.meaning}</strong></div>
                <div style="margin-top: 0.25rem; font-size: 0.75rem; opacity: 0.7;">Click anywhere or press any key to dismiss</div>
            `;
            
            // Add hint as fixed overlay to prevent layout displacement
            document.body.appendChild(hintDiv);
            
            // Auto-dismiss after 4 seconds
            setTimeout(() => {
                if (hintDiv.parentNode) {
                    hintDiv.parentNode.removeChild(hintDiv);
                }
            }, 4000);
            
            // Update hint button - only one hint available now
            hintBtn.disabled = true;
            hintBtn.style.opacity = '0.5';
            hintBtn.title = 'Hint already used';
        }
        
        function showEasterEgg() {
            if (guesses.length >= 5 && gameStatus === 'playing') {
                easterEggDiv.querySelector('.font-telugu').textContent = currentWord.syllables[0];
                easterEggDiv.style.display = 'block';
                setTimeout(() => {
                    easterEggDiv.style.display = 'none';
                }, 3000);
            }
        }
        
        // Event listeners
        englishInput.addEventListener('input', updatePreview);
        englishInput.addEventListener('keydown', (e) => {
            // Dismiss any hints on key press
            dismissHint();
            
            if (e.key === 'Enter') {
                e.preventDefault();
                submitGuess();
            }
        });
         englishInput.addEventListener('input', updatePreview);
        englishInput.addEventListener('keydown', (e) => {
            // Dismiss any hints on key press
            dismissHint();
            
            if (e.key === 'Enter') {
                e.preventDefault();
                submitGuess();
            }
        });
		// Add this new event listener after your existing ones
		englishInput.addEventListener('input', function(e) {
			// Only auto-lowercase if the user typed naturally (not using Shift/Caps deliberately)
			const value = e.target.value;
			const lastChar = value.slice(-1);
			
			// If it's the first character and it's uppercase, convert to lowercase
			// This handles auto-capitalization but allows deliberate caps
			if (value.length === 1 && lastChar === lastChar.toUpperCase() && lastChar !== lastChar.toLowerCase()) {
				e.target.value = value.toLowerCase();
				updatePreview();
			}
		});
		
        submitBtn.addEventListener('click', submitGuess);
        helpBtn.addEventListener('click', toggleHelp);
        historyBtn.addEventListener('click', toggleHistory);
        hintBtn.addEventListener('click', showHint);
        newGameBtn.addEventListener('click', newGame);
        submitBtn.addEventListener('click', submitGuess);
        helpBtn.addEventListener('click', toggleHelp);
        historyBtn.addEventListener('click', toggleHistory);
        hintBtn.addEventListener('click', showHint);
        newGameBtn.addEventListener('click', newGame);
        
        // Global click handler to dismiss hints (mobile-friendly)
        document.addEventListener('click', (e) => {
            const hintDisplay = document.querySelector('.hint-display');
            if (hintDisplay && !hintDisplay.contains(e.target) && e.target !== hintBtn) {
                dismissHint();
            }
        });
        
        // Global keydown handler to dismiss hints
        document.addEventListener('keydown', (e) => {
            // Only dismiss if it's not the input field (to avoid interference)
            if (e.target !== englishInput) {
                dismissHint();
            }
        });
        
        // Easter egg functionality
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey && !easterEggTimer) {
                easterEggTimer = setTimeout(showEasterEgg, 3000);
            }
        });
        
        document.addEventListener('keyup', (e) => {
            if (easterEggTimer && (!e.ctrlKey || !e.shiftKey)) {
                clearTimeout(easterEggTimer);
                easterEggTimer = null;
            }
        });
        
        // Close modal on click outside
        helpModal.addEventListener('click', (e) => {
            if (e.target === helpModal) {
                toggleHelp();
            }
        });
        
        // Close history modal on click outside
        document.getElementById('historyModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('historyModal')) {
                toggleHistory();
            }
        });
        
        // Initialize game
        initializeGrid();
        updatePreview();
        updateGrid();
        updateGameStatus();
        
        // Show current date by default
        const currentDateDisplay = document.getElementById('currentDateDisplay');
        const today = new Date();
        const todayFormatted = today.toLocaleDateString('en-GB', { 
            day: '2-digit',
            month: 'short', 
            year: 'numeric'
        }).replace(/,/g, '');
        currentDateDisplay.textContent = todayFormatted;
        currentDateDisplay.style.display = 'block';
        
        hintBtn.title = 'Hint (requires at least one correct syllable)';
        englishInput.focus();
    </script>
</body>
</html>
